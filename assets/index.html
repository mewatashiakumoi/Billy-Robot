<!DOCTYPE html>
<html>
	<head>
		<title>Billy Robot</title>
		<meta charset="utf-8">
		<style>
		body {
			font: medium sans-serif;
		}
		
		#control {
			text-align: center;
			width: 180px;
		}
		</style>
	</head>
	<body>
		<h1>Billy Robot</h1>
		
		<!--<img src="/sensor/camera" id="view">-->
		
		<p id="control">
			<button value="forward">Forward</button>
			<br>
			<button value="left">Left</button>
			<button value="right">Right</button>
			<br>
			<button value="back">Backward</button>
		</p>
		
		<script type="text/javascript" src="jquery.min.js"></script>
		<script type="text/javascript">
			var command = 'stop';
			
			$('#control button').bind('mousedown', function(){
				command = $(this).val();
				startLoop();
			}).bind('mouseup', function(){
				command = 'stop';
			});
			
			var interval, stopCount, requestCounter = 0, leftSpeed, rightSpeed;
			
			function startLoop() {
				clearInterval(interval);
				interval = setInterval(function(){
					switch (command) {
					case 'left' :
						leftSpeed = -0.3;
						rightSpeed = 0.5;
						break;
					case 'right' :
						leftSpeed = 0.5;
						rightSpeed = -0.3;
						break;
					case 'forward' :
						leftSpeed = 0.6;
						rightSpeed = 0.6;
						break;
					case 'back' :
						leftSpeed = -0.5;
						rightSpeed = -0.5;
						break;
					default:
						leftSpeed = 0;
						rightSpeed = 0;
					}
					
					requestCounter++;
					var url = '/control?'+$.param({
						counter:requestCounter,
						left:leftSpeed,
						right:rightSpeed
					});
					$.post(url);
					
					
					if (command == 'stop') stopCount++;
					else stopCount = 0;
					if (stopCount > 5) clearInterval(interval);
				}, 80);
			}
			
			/*var originalSrc = $('#view').attr('src');
			var cameraInterval = setInterval(function(){
				$('#view').attr('src', originalSrc + '?' + new Date().getTime());
			}, 700);
			$('#view').click(function(){
				clearInterval(cameraInterval);
			});*/
		</script>
	</body>
</html>
